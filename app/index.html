<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Causeway</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="styles/main.css">

		<link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>

		<script src="/socket.io/socket.io.js"></script>
	</head>
	<body>

		<div id="causeway-text"></div>

		<script>

			var socket = io.connect('http://mbp.local:8000');
			socket.emit('addme', "a_user");

			socket.on('chat', function(data){
				console.log("chat: " + data);
			});

			socket.on('itemback', function(data){
				var elements = document.getElementsByClassName(data.phrase);
				for(var i = elements.length - 1; i >= 0; --i) {
					elements[i].className += " clicked";
					elements[i].style.color = data.color;
					elements[i].style.backgroundColor = data.color;
				}
			});

			function getRandomColor() {
			    var letters = '0123456789ABCDEF'.split('');
			    var color = '#';
			    for (var i = 0; i < 6; i++ ) {
			        color += letters[Math.floor(Math.random() * 16)];
			    }
			    return color;
			}

			function clickgo() {
				var elements = document.getElementsByClassName(this.className);
				for(var i = elements.length - 1; i >= 0; --i) {
					socket.emit('item', elements[i].className.split(" ")[1]);
					// console.log(elements[i].className.split(" ")[1]);
					elements[i].className += " clicked";
				}
			}

			window.onload = function() {

				var xhr= new XMLHttpRequest();
				xhr.open('GET', 'data/causeway.html', true);
				xhr.onreadystatechange= function() {
				    if (this.readyState!==4) return;
				    if (this.status!==200) return; // or whatever error handling you want
				    document.getElementById("causeway-text").innerHTML= this.responseText;
				    addEvents();
				};
				xhr.send();

				function addEvents() {
					var phrases = document.getElementsByClassName('phrase');
					for (var i = 0; i < phrases.length; i++) {
						phrases[i].addEventListener("click", clickgo, false);
						//phrases[i].addEventListener("touchstart", clickgo, false);
					}
				}

			};

		</script>

	</body>
</html>
