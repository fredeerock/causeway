<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Causeway</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="styles/main.css">

		<link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>

		<script src="/socket.io/socket.io.js"></script>
	</head>
	<body>

		<div id="causeway-text"></div>

		<script>

			var socket = io.connect('http://mbp.local:8000');
			socket.emit('addme', "a_user");

			socket.on('chat', function(data){
				console.log("chat: " + data);
			});

			socket.on('setSection', function(data) {
				console.log("the section is now: " + data.title);
				//TODO: add scrolling here...
				// scrollIntoView(data.sect);
				scrollto(data.sect);

			});

			// function scrollIntoView(eleID) {
			//    var e = document.getElementsByClassName("s"+eleID)[0];
			//    if (!!e && e.scrollIntoView) {
			//        e.scrollIntoView();
			//    }
			// }

			// function scrollto(element){ 
			// 	var ele = document.getElementsByClassName("s"+element)[0];
			// 	if (!!ele) {
  	// 				window.scrollTo(ele.offsetLeft,ele.offsetTop);
  	// 			}
			// }

			function scrollto(element) {
				var ele = document.getElementsByClassName("s"+element)[0];
			    // var scrollStep = -window.scrollY / (1000 / 15);
			    if (!!ele && ele.offsetTop > window.scrollY) {
				    var scrollInterval1 = setInterval(function(){
				    	console.log("offset: " + ele.offsetTop + " y: " + window.scrollY);
				       
				        if(ele.offsetTop > window.scrollY) {
				            window.scrollBy( 0, 7 );
				        } else {
				        	clearInterval(scrollInterval1);
				        }

				    },15);
				}

				if (!!ele && ele.offsetTop < window.scrollY) {
				    var scrollInterval2 = setInterval(function(){
				    	console.log("offset: " + ele.offsetTop + " y: " + window.scrollY);
				       
				        if(ele.offsetTop < window.scrollY) {
				            window.scrollBy( 0, -7 );
				        } else {
				        	clearInterval(scrollInterval2);
				        }

				    },15);
				}
			}

			socket.on('itemback', function(data){
				var elements = document.getElementsByClassName(data.phrase);
				for(var i = elements.length - 1; i >= 0; --i) {
					elements[i].className += " clicked";
					elements[i].style.color = data.color;
					elements[i].style.backgroundColor = data.color;
				}
			});

			function clickgo() {
				var elements = document.getElementsByClassName(this.className);
				for(var i = elements.length - 1; i >= 0; --i) {
					socket.emit('item', elements[i].className.split(" ")[1]);
					// console.log(elements[i].className.split(" ")[1]);
					elements[i].className += " clicked";
				}
			}

			window.onload = function() {

				var xhr= new XMLHttpRequest();
				xhr.open('GET', 'data/causeway.html', true);
				xhr.onreadystatechange= function() {
				    if (this.readyState!==4) return;
				    if (this.status!==200) return; // or whatever error handling you want
				    document.getElementById("causeway-text").innerHTML= this.responseText;
				    addEvents();
				};
				xhr.send();

				function addEvents() {
					var phrases = document.getElementsByClassName('phrase');
					for (var i = 0; i < phrases.length; i++) {
						phrases[i].addEventListener("click", clickgo, false);
						//phrases[i].addEventListener("touchstart", clickgo, false);
					}
				}

			};

		</script>

	</body>
</html>
